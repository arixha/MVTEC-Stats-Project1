### PROJECT 1 Covid19 - Statistics
# @authors: Ànnia, Rebecca, Rocío, Victor.


# READING DATA FROM EXCEL/CSV
library(readr);
library(tidyverse)

data <- read.csv("originalData/owid-covid-data.csv")
head(data)   # mostrar 10 1es files cada colm
names(data)  # mostrar nom colm

#ddCovid <- read_excel("originalData/owid-covid-data-131120.xlsx", col_names = TRUE, na="NA");
#ddExtra <- read_excel("originalData/country-info-clean.xlsx",col_names = TRUE, na="NA");


# is R reading data correctly?
# Has dd the correct number of ROWS and COLUMNS?
dim(data)

# TIPO DE OBJETO DATOS
class(data)

#check table
View(data)

#open access by name to columns
attach(data)
?attach

#are all columns of expected types?
sapply(data, class)

# reduir la bd eliminant colm --> https://www.listendata.com/2015/06/r-keep-drop-columns-from-data-frame.html 
data <- subset(data, select = -c(total_cases, new_cases, total_deaths, new_deaths, new_cases_per_million, new_deaths_per_million, icu_patients, hosp_patients, total_tests, new_tests, new_tests_per_thousand, positive_rate:stringency_index, aged_65_older, aged_70_older, extreme_poverty, diabetes_prevalence, female_smokers, male_smokers, life_expectancy, human_development_index))
names(data)  # mostrar nom colm


## DATES ##
class(data$date)  # --> ha ser data i no caràcter
library(lubridate)
data$date <- ymd(data$date)
class(data$date)

# x saber quants NA hi ha per colm
apply(is.na(data), 2, sum)

#### causes deaths ####
library(readxl)
dataDeaths <- read_excel("additionalData/data_mortality_causes_WHO_2016/data_mortality_causes_OK.xlsx")
head(dataDeaths)
View(dataDeaths)

sapply(dataDeaths, class)

# canviar nom colm
dataDeaths <- rename(dataDeaths, Bothsexes = `Both sexes`)
head(dataDeaths)
class(dataDeaths)

dataDeathsCountriesSelected <- filter(dataDeaths, Country %in% c("Belgium", "Croatia", "Cyprus", "Czechia", "Denmark", "Estonia", "France", "Germany", "Iceland", "Ireland", "Latvia", "Lithuania", "Malta", "Netherlands", "Norway", "Portugal", "Romania", "Slovenia", "Spain", "United Kingdom of Great Britain and Northern Ireland", "United States of America"))
View(dataDeathsCountriesSelected)

#####################################################################

# interpolate data para llenar datos NA
# imputeTS library
# https://www.rdocumentation.org/packages/imputeTS/versions/3.1

#care with missing data!!!!
table(Dictamen, useNA="ifany")

#What about ORDINAL VARIABLES?
barplot(table(Tipo.trabajo))

Tipo.trabajo<-factor(Tipo.trabajo, levels=c( "1", "2", "3", "4", "0"), labels=c("fixe","temporal","autonom","altres sit", "WorkingTypeUnknown"))
pie(table(Tipo.trabajo))
barplot(table(Tipo.trabajo))



#Export pre-processed data to persistent files, independent from statistical package
write.table(dd, file = "credscoCategoriques.csv", sep = ";", na = "NA", dec = ".", row.names = FALSE, col.names = TRUE)